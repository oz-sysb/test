- defaultTab: summary
  description: |-
    Bitflyerに要求済みで、結果がわからない件の取引状態を確認するバッチ
    ### 接続DB
    Devlin, Deedee, Daffy, DynamoDB
    ### カスタムログ
    /var/www/xx-aslan/api_ci_logs/log/bitflyer_exchange_YYYYMMDD.log
    ### 起動時間
    3分ごとに実行
    ### 起動時間の任意変更
    不可
    ### バッチ停止時の影響
     - BITCOINの交換処理が遅延し、交換申請がたまって、ユーザーのポイントが減ったまま、処理されない状態に陥る。<br> - (バッチを再起動すれば、古いデータから拾い処理される。だが、1分に30件まで処理できるので、処理がたまると、交換処理に遅延が発生する。)<br> - BITCOIN交換で、交換完了まで最大15分以内と案内しているので、10分以上停止するのはリスクがある。
    ### 注意事項
     - 10分未満の停止なら許容範囲、なるべく人が利用しない時間が望まれる。<br> - 10分以上の長い時間の停止が必要な時には、ビットコイン交換を止めてからするかを決める必要がある。<br> - 30分以上の長い時間の停止が必要な時には、ビットコイン交換を止めてから停止する必要がある。<br> - このバッチを他のサーバーで回すときは、既存のcronを停止してから、他のサーバーで回るようにする必要がある。<br> - バッチを停止するときは、KILLすることはしないほうがいい。最後まで回るのを待つのがいい。<br> - KILLした場合か、バッチが途中で止まった場合は、以下の処理が必要になる。<br>   - deedee.batch_logのデータの修正が必要です。<br>   - (end_dateを直すか、該当するrowを削除するか、バッチの名前は、BitflyerTP::apply, BitflyerTP::statuscheck)<br>   - bitflyer_exchange_dataの交換申請中(process_status=9)のデータを0にupdateして、交換を回すか、交換失敗に処理する必要がある。
    ### Backlog
    https://ozvision.backlog.jp/view/PRODUCT-195
  executionEnabled: true
  group: 交換
  id: 790f23f8-9e4f-410f-a9e0-d8c0ebb8dc30
  loglevel: INFO
  name: bitflyer_statuscheck.sh
  nodeFilterEditable: true
  nodefilters:
    dispatch:
      excludePrecedence: true
      keepgoing: false
      rankOrder: ascending
      successOnEmptyNodeFilter: false
      threadcount: '1'
    filter: host_hn_aslan01
  nodesSelectedByDefault: true
  notification:
    onavgduration:
      plugin:
        configuration:
          webhook_url: https://hooks.slack.com/services/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
        type: SlackNotification
    onfailure:
      plugin:
        configuration:
          webhook_url: https://hooks.slack.com/services/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
        type: SlackNotification
    onretryablefailure:
      plugin:
        configuration:
          webhook_url: https://hooks.slack.com/services/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
        type: SlackNotification
    onsuccess:
      plugin:
        configuration:
          webhook_url: https://hooks.slack.com/services/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
        type: SlackNotification
  notifyAvgDurationThreshold: null
  schedule:
    dayofmonth:
      day: '*'
    month: '*'
    time:
      hour: '*'
      minute: '*/3'
      seconds: '0'
    year: '*'
  scheduleEnabled: false
  sequence:
    commands:
    - script: bitflyer/bitflyer_statuscheck.sh
    keepgoing: false
    strategy: node-first
  uuid: 790f23f8-9e4f-410f-a9e0-d8c0ebb8dc30

